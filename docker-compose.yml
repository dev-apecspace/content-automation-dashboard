
services:
  conetent-apec-global:
    container_name: conetent-apec-global
    image: conetent-apec-global
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
        - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
        - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
        - NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=${NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}
        - NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET=${NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET}
        - JWT_SECRET=${JWT_SECRET}
        - ENCRYPTION_KEY=${ENCRYPTION_KEY}
        - NEXT_PUBLIC_POST_TRIGGER_WEBHOOK=${NEXT_PUBLIC_POST_TRIGGER_WEBHOOK}
        - NEXT_PUBLIC_VIDEO_TRIGGER_WEBHOOK=${NEXT_PUBLIC_VIDEO_TRIGGER_WEBHOOK}
        - NEXT_PUBLIC_SEARCH_IDEAS_WEBHOOK=${NEXT_PUBLIC_SEARCH_IDEAS_WEBHOOK}
        - NEXT_PUBLIC_ENGAGEMENT_TRACKER_WEBHOOK=${NEXT_PUBLIC_ENGAGEMENT_TRACKER_WEBHOOK}
        - NEXT_PUBLIC_REMOVE_POST_WEBHOOK=${NEXT_PUBLIC_REMOVE_POST_WEBHOOK}
        - NEXT_PUBLIC_EDIT_CONTENT_WEBHOOK=${NEXT_PUBLIC_EDIT_CONTENT_WEBHOOK}
        - NEXT_PUBLIC_EDIT_MEDIA_WEBHOOK=${NEXT_PUBLIC_EDIT_MEDIA_WEBHOOK}
        - NEXT_PUBLIC_AUTO_POST_WEBHOOK=${NEXT_PUBLIC_AUTO_POST_WEBHOOK}
        - NEXT_PUBLIC_POST_NOW_WEBHOOK=${NEXT_PUBLIC_POST_NOW_WEBHOOK}
        - NEXT_PUBLIC_UPDATE_POST_WEBHOOK=${NEXT_PUBLIC_UPDATE_POST_WEBHOOK}

    env_file:
      - .env  
    ports:
      - "127.0.0.1:3007:3007"

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://127.0.0.1:3007"]
      interval: 30s
      timeout: 5s
      retries: 3

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
